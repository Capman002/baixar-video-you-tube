<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baixar Vídeo - Download de Vídeos do YouTube</title>
    <meta
      name="description"
      content="Ferramenta profissional para download de vídeos do YouTube em alta qualidade."
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        font-family: "Inter", sans-serif;
      }
      body {
        background: #0a0a0a;
        color: #fff;
      }
      .glass-panel {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .progress-bar {
        transition: width 0.2s ease;
        box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
      }
    </style>
  </head>

  <body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-xl p-8 glass-panel rounded-2xl">
      <!-- Header -->
      <header class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-white mb-2">Baixar Vídeo</h1>
        <p class="text-gray-400 text-sm">
          Download de vídeos do YouTube em alta qualidade
        </p>
      </header>

      <!-- Input -->
      <div class="space-y-4">
        <div class="relative">
          <input
            type="text"
            id="urlInput"
            class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-red-500/50 transition-colors"
            placeholder="Cole o link do YouTube aqui..."
          />
        </div>

        <button
          id="downloadBtn"
          onclick="iniciarDownload()"
          class="w-full py-3 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg transition-all active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Baixar Vídeo
        </button>
      </div>

      <!-- Status Area -->
      <div id="statusArea" class="mt-6 hidden">
        <div class="flex justify-between text-xs text-gray-400 mb-2">
          <span id="statusText">Processando...</span>
          <span id="speedText">0 MB/s</span>
        </div>

        <div class="h-2 w-full bg-white/10 rounded-full overflow-hidden">
          <div
            id="progressBar"
            class="h-full bg-red-500 progress-bar w-0"
          ></div>
        </div>

        <div class="mt-2 text-right text-xs text-gray-500" id="pctText">0%</div>
      </div>

      <!-- Footer -->
      <footer class="mt-8 pt-4 border-t border-white/5 text-center">
        <p class="text-gray-600 text-xs">
          Powered by yt-dlp • Código aberto no GitHub
        </p>
      </footer>
    </div>

    <script>
      const socket = io({ transports: ["websocket"] });
      let sid = null;

      const ui = {
        input: document.getElementById("urlInput"),
        btn: document.getElementById("downloadBtn"),
        area: document.getElementById("statusArea"),
        bar: document.getElementById("progressBar"),
        status: document.getElementById("statusText"),
        speed: document.getElementById("speedText"),
        pct: document.getElementById("pctText"),
      };

      socket.on("session_id", (data) => (sid = data.sid));

      function iniciarDownload() {
        const url = ui.input.value.trim();
        if (!url) {
          ui.input.classList.add("border-red-500");
          setTimeout(() => ui.input.classList.remove("border-red-500"), 1000);
          return;
        }

        ui.btn.disabled = true;
        ui.btn.innerText = "Baixando...";
        ui.area.classList.remove("hidden");
        ui.status.innerText = "Conectando...";

        socket.emit("start_download", { url });
      }

      socket.on("download_progress", (data) => {
        ui.bar.style.width = data.percentage + "%";
        ui.pct.innerText = data.percentage + "%";
        ui.speed.innerText = data.speed;
        ui.status.innerText = "Baixando...";

        if (data.percentage >= 100) {
          ui.status.innerText = "Finalizando...";
          ui.bar.classList.add("animate-pulse");
        }
      });

      socket.on("download_complete", (data) => {
        ui.status.innerText = "Concluído!";
        ui.bar.classList.remove("animate-pulse");

        // Auto-download
        const link = document.createElement("a");
        link.href = data.url;
        link.download = data.filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Reset UI
        setTimeout(() => {
          ui.btn.innerText = "Baixar Vídeo";
          ui.btn.disabled = false;
          ui.area.classList.add("hidden");
          ui.input.value = "";
          ui.bar.style.width = "0%";
          ui.pct.innerText = "0%";
        }, 2000);
      });

      socket.on("download_error", (data) => {
        alert("Erro: " + data.error);
        ui.btn.disabled = false;
        ui.btn.innerText = "Tentar Novamente";
        ui.status.innerText = "Erro";
        ui.bar.style.backgroundColor = "#ef4444";
      });
    </script>
  </body>
</html>
